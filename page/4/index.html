
 <!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  
    <title>Firo Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Firo Yang">
    

    
    <meta name="description" content="firo">
<meta property="og:type" content="website">
<meta property="og:title" content="Firo Notes">
<meta property="og:url" content="http://firoyang.org/page/4/">
<meta property="og:site_name" content="Firo Notes">
<meta property="og:description" content="firo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Firo Notes">
<meta name="twitter:description" content="firo">
<meta name="twitter:creator" content="@firoter">
<link rel="publisher" href="116338260303228780000">


    
    <link rel="alternative" href="/atom.xml" title="Firo Notes" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Firo Notes" title="Firo Notes"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Firo Notes">Firo Notes</a></h1>
				<h2 class="blog-motto">kernel, philosophy, beautiful things</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:firoyang.org">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/28/physical/" title="Physical life" itemprop="url">Physical life</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/116338260303228780000?rel=author" title="Firo Yang" target="_blank" itemprop="author">Firo Yang</a>
		
  <p class="article-time">
    <time datetime="2014-12-27T16:00:00.000Z" itemprop="datePublished"> Published Dec 28 2014</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Body">Body</h1>
<h2 id="Soma_Now_Future">Soma                    Now                                        Future</h2>
<p>Face<br>Skin                    A fight! Turn to white…</p>
<ul>
<li>Belly, Abdomen<br>Crunsh(Not Situps), Leg raise<br>1、配合有氧运动减脂，这是关键，否则仰卧起坐也不用做了，最好的减脂运动就是有氧运动，这个说来话长，不深入了；<br>2、每天都要对腹肌进行刺激，这样才能保证不退化；<br>3、放弃大强度疲劳训练；<br>4、腹肌训练放在每次训练的最后；<br>5、每次训练只要选择一个动作，做3组，每组20-30次即可，当然要达到有效地刺激；</li>
</ul>
<p>Chest,Pectorails        Dumbbell fly; Bench press; Pushups 30+1/day<br>Back                    Pull-up<br>Shoulder,Deltoid        Front raise;Shoulder fly; Handstand push-up<br>Arms, Biceps            Biceps up, Chin up<br>Leg<br>Eyes<br>Ears                    40 ~ 60 decibel, wear headset not beyond 3 ~ 4<br>                        hour, relax/half hour<br>Masturbation            2 times max per week the less the better.<br>Shoulder width            53                                        176/4=44 ~ 52cm<br>肩围                    106<br>Height                    177cm<br>Weight                    67kg                                    77kg<br>+Burst/胸围                85cm                                    106<br>上臂围                    27cm                                    36<br>Thigh/大腿围            51cm                                    54<br>+Waistline/腰围            84                                        79<br>Hip line                87cm                                    94cm ~ 112cm</p>
<h2 id="Skin_care">Skin care</h2>
<ul>
<li>不熬夜, 早睡, 早起!</li>
<li>Fitness</li>
<li>Cleansing<br>  Daily ?<br>  Lab series multi-action face wash</li>
<li>Toning<br>  Water, more water.</li>
<li>Moisturizing<br>  Kiehl‘s ultra facial cream!</li>
<li>Exfoliants<br>  For face, once a week.<br>  ?</li>
</ul>
<h1 id="Physical_life">Physical life</h1>
<h2 id="Clothing(no_jeans)_Now_Future">Clothing(no jeans)    Now                                                Future</h2>
<ul>
<li>大方合体美感</li>
<li>让掉不合适的衣服<br>Tank tops                2 Playboy<br>Sweatshirts &amp; Hoodies    1 Adidas                                        +1<br>Boxer brief                2                                                +0<br>T-shirt                 5                                                5<br>Dress shirt                3                                                3(-2 + 2)<br>Thermal underware        0                                                1<br>Trousers                5<br>Hoodies                    1 adidas<br>Casual shorts           0                                                (+2)<br>Sweatpants                3 anta, adidas, A&amp;F<br>Down jackets/coats        2 null/ Jack jones</li>
</ul>
<h2 id="Shoes">Shoes</h2>
<p>Sneaker                    0                                                2 Converse and Warrior<br>Skate shoes                1    Nike                                        2<br>Slippers                1                                                new 1                                                </p>
<h2 id="Accessories">Accessories</h2>
<p>Scarf                   1    Cacuss<br>Mask                    1<br>Gloves                  0<br>Beanie                    1    Whitebird</p>
<h2 id="Travel">Travel</h2>
<p>Luggage &amp; Bag           Travalue bag<br>                        Laptop computer cases</p>
<h2 id="Money">Money</h2>
<h2 id="Accessory_Now_Future">Accessory            Now                                                Future</h2>
<p>Phone                    Nexus 5<br>                        Android 5.0<br>Laptop                    Y460                                            Intel haswell | Chrome pixel<br>                        Fedora 21<br>                        Gnome 3.14.2<br>                        Vim 7.4<br>                        Chrome 39<br>Keyboard                Laptop built-in<br>Hard drive                Buffalo ministation                                NULL</p>
<h2 id="Residency">Residency</h2>
<p>Razor                    Schick quatto titanium and hydro<br>Chair                                                                    Steelcase think chair<br>Mug                        1                                                2</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/firo/">firo</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/12/28/physical/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/28/philosophy/gallery/" title="漂亮的话" itemprop="url">漂亮的话</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/116338260303228780000?rel=author" title="Firo Yang" target="_blank" itemprop="author">Firo Yang</a>
		
  <p class="article-time">
    <time datetime="2014-12-27T16:00:00.000Z" itemprop="datePublished"> Published Dec 28 2014</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Griffith">Griffith</h1>
<p>是的 就连一个国王也不能真正的随心所欲地生活 我们都只是随着命运的波浪漂流而已<br>直到我们最终离开这个世界 时间是有限的 而且命运在我们知道自己之前就会退去 在这个世界里 一定有一个人命中注定… 无论他的社会地位和阶层如何 我一定要知道我在这个世界真正的身份是什么！我命中注定的东西到底是什么？<br>无谓的悲伤是没有用的<br>面对随时可能离去的生命<br>只有牢牢抓紧它不去浪费<br>才对得起昨日离开之人无限渴望的今日</p>
<p>梦想可以左右世界 可以让一个人一生而为之 很多梦想只能在孤独中苦苦寻求 而有些梦想则会在瞬间化为泡影 梦想能给人以支撑 也能带来巨大的苦痛<br>即使人被他的梦想所抛弃 仍然会有些东西是深深的郁结在他心中 每个人都应该为自己的梦想 去承受巨大的痛苦 至少一次 能够这样对待他们的生活<br>有些人认为生命不过是长时间的生活而后突然的死去 我从心底讨厌这种想法 也绝不认同它<br>我认为真正的朋友从不依赖他人的梦想 一个真正能成为我朋友的人 必须能靠自己而不是我的帮助 明白为了什么而生活 他必须全身心地投入<br>保护好他自己的梦想 必须毫不犹豫的为了自己的梦想而战斗 甚至是和我战斗</p>
<p>我不能有遗憾和负罪感</p>
<p>想要实现广大而纯洁的梦想的人不可避免的要忍受可怕的事情 我们并非天生强大</p>
<p>我从你的眼中看到一些熟悉的东西 恐惧的味道 当一个人发现他十分恐惧的东西时 他会意识到不能坐视不管 不得不作出选择<br>要么屈服于恐惧的事物以求自保 要么消灭所害怕的事物来消除恐惧感</p>
<p>在这个空壳一样的世界 有一样东西清晰印在我的脑海中<br>每个人都很虚弱 因此我们紧紧地同我们的希望与梦想抱在一起 安慰也好 我渴望有人在我身边</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/philosophy/">philosophy</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/12/28/philosophy/gallery/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/28/kernel/mm/" title="Linux kernel memory management" itemprop="url">Linux kernel memory management</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/116338260303228780000?rel=author" title="Firo Yang" target="_blank" itemprop="author">Firo Yang</a>
		
  <p class="article-time">
    <time datetime="2014-12-27T16:00:00.000Z" itemprop="datePublished"> Published Dec 28 2014</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Memroy_mangement">Memroy mangement</h1>
<h2 id="GFP_flags">GFP flags</h2>
<p><strong>GFP_IO: allow disk IO
</strong>GFP_FS: allow fs operations, depend on io.<br>more details in lwn, lkd</p>
<h1 id="Virtual_memory">Virtual memory</h1>
<h2 id="What_is_virtual_memory?">What is virtual memory?</h2>
<p>In computing, virtual memory is a memory management technique<br>that is implemented using both hardware and software.<br>It maps memory addresses used by a program, called virtual addresses,<br>into physical addresses in computer memory.</p>
<h2 id="Page_table">Page table</h2>
<p>mk_pte(page, pgprot)    pfn_pte(page_to_pfn(page), (pgprot))<br>原来低12位里面存了flag啊!<br>__pte(((phys_addr_t)page_nr &lt;&lt; PAGE_SHIFT) | massage_pgprot(pgprot));<br>For vmalloc(), chechk here vmap_page_range_noflush()<br>For kmap(), check kmap_init()<br><a href="http://edsionte.com/techblog/archives/1966" target="_blank" rel="external">How to emulate the process of translate va to pa?</a></p>
<h2 id="copy_to_user">copy_to_user</h2>
<p>not in kernel?<br>read only?</p>
<h2 id="flush_tlb_after_page_table_modification-">flush tlb after page table modification.</h2>
<h2 id="Direct_mapping_area">Direct mapping area</h2>
<p>high_memory (-128UL &lt;&lt; 20)<br>__get_free_pages()<br>kmalloc()<br>kmem_cache_alloc()/slab</p>
<h2 id="Vmalloc">Vmalloc</h2>
<p>may sleep.</p>
<h3 id="Hwo_Vmalloc_works?">Hwo Vmalloc works?</h3>
<p>Work in HIGHMEM and NORMALMEM<br>The skeleton is rbtree, root is global variable vmap_area_root.rb_node.<br>struct vm_struct likes struct address_space, functionlly;<br>struct vmap_area likes struct vm_area_struct.<br>map_vm_area 页表映射<br>the page in ZONE_NORMAL will not use directly mapping pfn address! It use VMALLOC address! </p>
<h3 id="Vmalloc_coherence_with_vfree()_after_vmalloc_sync_one">Vmalloc coherence with vfree() after vmalloc_sync_one</h3>
<p>在进程的内核页目录中补上的是只是页目录项，而页表对所有进程来说是共用的，不管vfree()多大的内存块，在vmalloc()时新分配的页表不会被释放，当重新vmalloc()时，仍旧使用原来的页表。 page_fault使得进程的内核页目录项与swapper_pg_dir保持同步，swapper_pg_dir的内核页目录项一旦建立就不再被改变，需要改变的只是共享的页表而已。<br>deatils in vmalloc_sync_one() and vunmap_pte_range()<br>只释放pte</p>
<h2 id="Persistent_Kernel_Mappings">Persistent Kernel Mappings</h2>
<p>kmap(struct page *)<br>How kmap works?<br>    Check kmap_init(), later!</p>
<h2 id="Temporay_Mappings(Fixmaps)">Temporay Mappings(Fixmaps)</h2>
<p>kmap_atomic()</p>
<h2 id="Process_virtual_memory">Process virtual memory</h2>
<ul>
<li>struct vm_area_struct: The intervals of legal address are called <em>memory areas</em> is permitted to access.</li>
<li>struct address_space: To establish an association between the regions of the vm and the places where the related data are located.<br>i_mmap: how many processes opened this file.<br><a href="https://lkml.org/lkml/2012/8/7/46" target="_blank" rel="external">https://lkml.org/lkml/2012/8/7/46</a></li>
<li><p>sturct mm_struct: how many files(vm_area_struct) does this process opened.</p>
</li>
<li><p>Memory mappings<br>syscall remap_file_pages Nolinear mappings is deprecated, since Linux 3.16</p>
</li>
<li><p>link<br>a virtual address and physical address. —page tale<br>a memory region of a process and its virtual page addresses. —vm_area_struct<br>a region of file(one physical) and all virtual address spaces(many virtual) into which the region is mapped. address_space-&gt;i_mmap.<br>a physical page and the processes that share the page(used in swap case) </p>
</li>
</ul>
<h1 id="Page_faults">Page faults</h1>
<p>Page fault: If a process accesses a part of virtual address space not yet associated with a page in memory</p>
<ul>
<li><p>Segemnt fault<br>Segment fault: address is not in VMA, namely invalid address! Check bad_area() in x86.<br><a href="https://www.kernel.org/doc/Documentation/x86/exception-tables.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/x86/exception-tables.txt</a><br>Null pointer: probably, mostly catched in below 0x08048000.</p>
</li>
<li><p>Demanding page<br>vmalloc_fault(), 进程从用户态进入内核态不会引起CR3的改变.页表同步!<br>expand_stack()/handle_mm_fault()</p>
</li>
<li><p>vmalloc fault</p>
</li>
<li><p>Oops<br>kernel access invalid address, in __print_signal_info() task-&gt;sighand and  task-&gt;nsproxy is null.</p>
</li>
</ul>
<h1 id="Physical_memory">Physical memory</h1>
<ul>
<li>NUMA/UMA pg_data_t: My PC is UMA, numatop, numastat, numactl</li>
<li>ZONE(DMA/NORMAL/HIGHMEM) struct zone:</li>
<li>struct page is the basic unit of kernel mm knowns as page frame.<br>  The goal of strcut page is to describe physical memory, not the data contained therein.</li>
<li>The buddy system is per-zone struct free_area</li>
<li>Physical address is connected to Virtual address by pfn = page - mem_map;<h2 id="page_allocator">page allocator</h2>
alloc_pages()<h2 id="Page/buffer_cache">Page/buffer cache</h2>
struct address_space-&gt;page_tree<h2 id="Page_writeback">Page writeback</h2>
data synchronization, the flush threads, pdflush<h2 id="Page_swap">Page swap</h2>
The available RAM memory in a computer is never enough to meet user needs or to always satisfy memory-intensive applications.</li>
</ul>
<h1 id="FAQ">FAQ</h1>
<ul>
<li><p>Where is Per-CPU variable?<br>static Per-CPU in .data(?) below high_memory!<br>runtime Per-CPU, it’s GFP_KERNEL in pcpu_create_chunk()</p>
</li>
<li><p>Memory mode<br>flat mem -&gt; uma<br>discontig -&gt; NUMA<br>sparse -&gt; Hotplug + NUMA</p>
</li>
<li><p>When does kernel alloc these struct pages in x86_64?<br><a href="http://lwn.net/Articles/229670/" target="_blank" rel="external">http://lwn.net/Articles/229670/</a><br>vmemmap silimar to memmap</p>
</li>
<li><p>When kmap_atomic() BUG_ON effect?</p>
</li>
<li><p>How cpu resolve address below high_memory?<br>Cpu-spicific!<br>x86 used page table to all address!<br>Mips cpu can be aware of this address!</p>
</li>
<li><p>How to deal with useless page? : &gt; /home/firo/bigdata</p>
</li>
</ul>
<p>*pfmemalloc — skb 表示申请了紧急内存!<br>page free</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/kernel/">kernel</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/12/28/kernel/mm/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/28/cogito/" title="The perspective of thinking" itemprop="url">The perspective of thinking</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/116338260303228780000?rel=author" title="Firo Yang" target="_blank" itemprop="author">Firo Yang</a>
		
  <p class="article-time">
    <time datetime="2014-12-27T16:00:00.000Z" itemprop="datePublished"> Published Dec 28 2014</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="IBM_maturity_model">IBM maturity model</h1>
<p><a href="https://www-935.ibm.com/services/uk/cio/pdf/leverage_wp_data_gov_council_maturity_model.pdf" target="_blank" rel="external">https://www-935.ibm.com/services/uk/cio/pdf/leverage_wp_data_gov_council_maturity_model.pdf</a></p>
<h1 id="overview">overview</h1>
<ul>
<li>理性<br>模仿与思考<br>只能达成概念上的一一性<br>大多数, 都是很诚实的.<br>既然是概念, 就应停留在语言层面.人类的就够了.<br>不是所有知识都能通过实践获得.非实践知识,<br>not sure, 看到别人的聪明也要看到傻<br>实践验证应该是以概念体系位整体, 不应该是某个思维碎片.</li>
<li>实践<br>trail and error<br>还是要看到优劣, 所谓批判.</li>
</ul>
<h1 id="Critical_cognition">Critical  cognition</h1>
<ul>
<li>Original construct —Firo<br>对于理解者, 分为:<br>从0思考,<br>模拟, 无论是实践还是理性的认知理解.<br>这种差异根本性的构建了理解者的知识模型.</li>
</ul>
<p>明确概念的内涵和外延 —石里克.</p>
<p>你所学的一切都是暂时性的,任何所学都有改口 驳斥 质疑的余地; —Aaron Swartz,25:20<br>I feel very strongly that it’s not enough to just live in the world as it is, it’s just kind of take what you are given,<br>and you know follow the things that adults told you to do,and that your parents told you to do, and that society tells to do.<br>I think you should always be questioning.I take this very scientific attitude that<br>every thing you’ve learned  is just provisional, you know, it’s always open to recantation or refutation or questioning,<br>and I think  the same applies to society. Once I realized that there were real serious problems, fundamental problems<br>that I could do something to address, I didnt see a way to forget that, I didnt see a way not to.</p>
<p>人类是无法知道真理的，他们所能做的，最多就是通过不断的实验和错误来摸索、接近真理。 —Karl Popper, 索罗斯 </p>
<p>明变, 求因, 评判<br>实验是真理的唯一试金石 — 胡适</p>
<p>胡适日记全集》第三册，1921年7月10一则<br>杜威先生不曾给我们一些关于特别问题的特别主张，——如共产主义，无政府主义，自由恋爱之类，——他只给了我们一个哲学方法，<br>使我们用这个方法去解决我们自己的特别问题。</p>
<ul>
<li>（1）历史的方法——“祖孙的方法”   the genetic method, why xxx?<br>他从来不把一个制度或学说，看做一个孤立的东西，总被他看做一个中段；一头是他所以发生的原因，一头是他自己发生的效果；上头有他的祖父，下头有他的孙子。捉住了这两头，他再也逃不出去了！这个方法的应用，一方面是很忠厚宽恕的，因为他处处指出一个制度或学说所以发生的原因，指出他历史的背景，故能了解他在历史上的地位和价值，故不致有过分的苛责。一方面，这个方法又是很严厉的，最带有革命性质的。因为他处处拿一个学说或制度发生的结果，来评判他本身的价值，故最公平，又最利害。这种方法，是一切带有评判（Critical）精神的运动的一个武器。</li>
</ul>
<p>Firo note:<br>Origin trace 起源主义, 更偏重发生的原因,起源.</p>
<ul>
<li>（2）实验的方法　　实验的方法，至少注重三件事：<br>（一）从具体的事实与境地下手；<br>（二）一切学说理想，一切知识，都只是待证的假设，并非天经地义；<br>（三）一切学说与理想，都须用实行来试验过。实验是真理的唯一试金石。<br>第一件，——注意具体的境地——使我们免去许多无谓的问题，省去许多无意识的争论。<br>第二件，——一切学理都看做假设——可以解放许多“古人的奴隶”。<br>第三件，——实验——可以稍稍限制那上天下地的妄想冥想。实验主义只承认那一点一滴做到的进步，步步有智慧的指导，步步有自动的实验——才是真进化。</li>
</ul>
<p>所谓实验的方法应该看成实证主义, 而不是更宽泛的实用主义. 维也纳小组, 即是逻辑实证主义.<br>trial and error</p>
<ul>
<li>Abstruction method</li>
</ul>
<ol>
<li>解决知识的skeleton, 原理.</li>
<li>建立同其他原理相似的知识的联系</li>
<li>得到从一般的定义推理.</li>
</ol>
<ul>
<li><p>为什么用, 怎么用, why/how to use<br>谁产生的, 怎么产生的 or 什么样子<br>对齐, cpu 访问内存的时候用, 直接受用于编译的结果.<br>编译器生成struct代码的时候, 产生的代码安基础类型对齐, </p>
</li>
<li><p>Exploration in Scott Young<br>Depth exploration is the genetic method, 因果<br>Lateral exploration 和周围的关系, 涵盖比较广.实验法从具体事实与境地下手.<br>Vertical Exploration is the abstruction method, focus on mode and link to derivations. It use to connects with other knowledge.</p>
</li>
</ul>
<h1 id="What_is_knowledge?">What is knowledge?</h1>
<p>不是所有知识都能通过实践获得.非实践知识,或许人类语言理解就可以了.</p>
<ul>
<li><p>conception system<br>knowledge is a coneption system, not a something heaping up<br>We need a good construct in mind.<br>mode is an abstructions.<br>认知的unit是概念!!!<br>错误的认知, 来自错误的概念!<br>学习就是建立一套知识框架的过程, 在框架下概念彼此联系.<br>如果没能建成, 实践久, 就会忘掉.<br>框架的建立, 就是从宏观概念待细节的探索.<br>而且这个框架必须是完整健全的人类语言形式的.<br>可以很少, 但必须是明确的, 不能有歧义.<br>为了保证语义的明晰,概况能力, 必须要减少表述的内容.</p>
</li>
<li><p>从general concept or 直观推导出.<br>否则就是记忆.<br>Category can be general</p>
</li>
<li><p>一一性</p>
</li>
<li><p>知识的含量, 通过概念的统摄能力看到, 而不是抽象度.</p>
</li>
<li><p>The thing that hath been, it is that which shall be; and that which is done<br>is that which shall be done and there is no new thing under the sun.<br>问题总是复杂的, 解决方法总是简单的  —xiaolai.li</p>
</li>
</ul>
<h1 id="Growing_up_—_人最重要的是会成长!">Growing up — 人最重要的是会成长!</h1>
<p>生长需要滋润.  生活作息必须规律, 要不然要影响其他生活. 今天,就到这里吧, 让生活井井有条, 滋润.</p>
<ul>
<li>成长开始于注意到缺陷, 疑问<br>那种概念模糊的地方就是有问题, 比如两个指针相加.</li>
</ul>
<p>成长不同阶段, 比如页表回收又算法,也有具体的代码实现. 我们只要知道算法就可以了.</p>
<p>Listen, the key is to just… relax. Don’t worry about the numbers, don’t worry about what the other guys are thinking. </p>
<p>Dont think… just feel</p>
<p>所谓的自我认知不是达成一切，不是什么事情都要做到完美，而是知道自己所能做到力所能及的事情和无能为力的事情，我要说的是，要学会原谅自己的无能为力 </p>
<p>当缺点和不足出现了, 你意识到它, 并且有意识地去思考这种不足的原因,你就在成长中! 有自己的想法, 这才是成长的本质, 其他都不算成长. </p>
<ul>
<li>很多时候其实我们的忙碌都是做着自己并不在乎的事情！</li>
</ul>
<p>一个有创造力的人把太多的时间耗在阅读上，是一种浪费 —尼采<br>对于一个哲学家来说，最重要的是独立思考，自己来创造，说出非他不能说出的话来。</p>
<p>不要以为努力过后, 就会得到, 永远也不要这样想. </p>
<h1 id="人生">人生</h1>
<p>人们一边浪费自己的时间, 一边希望获得更久一些.</p>
<p>人生没有目标, 也要好好活着!</p>
<p>10点睡觉, 洗澡, 锻炼健身, 时间统计.</p>
<p>不做無異事，一日當三日，人活五十年，我活百五年。 (我以为少做 —firo.)<br>讀古人的書，一方面要知道古人聰明到怎樣，一方面也要知道古人傻到怎樣。<br>人生的大病根本在於不肯睜開眼睛來看世間的真實現狀.<br>不受人惑 — 胡适</p>
<p>做人莫不可失了做事之心态— firo</p>
<p>人如果不沉醉于某些东西,估计都撑不下去吧.<br>所有人都是某些东西的奴隶 — 进击的巨人</p>
<h1 id="Society">Society</h1>
<p>生活就是同傻逼的战争!</p>
<p>每个人都有自己内心的弱点, 不必害怕他们.</p>
<p>Love the persons that love me, absolutely, included myself and girl friend!</p>
<p>他人即地狱,世界是荒诞的.</p>
<p>出来卖, 活一定要好.</p>
<p>人类是一种急功近利的生物，总是想用最小的付出获得最大的受益。 </p>
<h1 id="Philosophy">Philosophy</h1>
<p>物自体-&gt;感知-&gt;经验对象-&gt;认知-&gt;概念</p>
<p>我们所做的乃是把词从形而上学的使用带回到日常的使用上来”。</p>
<p>我们能够陈述的只是语言的“外部事实”，我们对语言的误解来自对词的使用的不清——“我们的语法缺乏这种清晰性”。面对不清晰的语法，“哲学的任务并不是通过数学或逻辑数学的发现去解决矛盾，而是使我们有可能看清楚给我们造成麻烦的数学的现状：在矛盾解决之前的事态”，哲学的身份是“只把一切都摆在我们面前，既不作说明也不作推论”。</p>
<h2 id="Foundations">Foundations</h2>
<ul>
<li>认识是人脑对外界事物的反映</li>
<li>认识的对象</li>
</ul>
<ul>
<li>存在就是不同.</li>
</ul>
<ul>
<li>认识的方法</li>
</ul>
<ul>
<li>划分就是要从混沌中找出不同<br>=现象与根本</li>
<li>现象不同的存在</li>
<li>根本相同的存在<br>=静态与动态<br>=宏观与微观<br>宏观是指从整体、全局来看;微观是指从个体、局部来看<br>系统是由相互作用的元素所构成的整体;元素是系统的组成部分<br>宏观的存在称为事物,构成该事物的微观的存在称为该事物的来源<br>事物是客观存在的一切物体及其表现出的现象，比如原子是“物”，原子的行为表现是其“现象”，统合在一起，就是原子这么个“事物”。</li>
</ul>
<p>=实体与作用<br>主体是目的实体,就是被作为目的的实体<br>客体是手段实体,就是被作为手段的实体</p>
<p>作用就是影响,实体对实体影响就叫做作用<br>属性实际上就是外在表现角度的实体的作用<br>事物之间的相互作用就叫做关系</p>
<p>客体对主体的作用叫做功用; 主体对客体的作用叫做利用</p>
<p>功用就是价值<br>=形式与内容<br>内容指构成事物的一切内在要素的总和；<br>形式指事物内在要素的结构或表现方式。</p>
<ul>
<li>区别是对已经存在的多个事物进行比较,找出它们之间的不同之处,现象</li>
<li>联系是对已经存在的多个事物进行比较,找出它们之间的相同之处,根本</li>
</ul>
<p>+静态存在<br>事物实体的形式——结构,结构是事物内部诸元素之间的空间关系<br>事物实体的内容——质料<br>事物作用的形式一般被称为方式。<br>事物作用的内容是输入与输出。<br>事物关系的形式一般就叫做形式<br>事物关系的内容是交换<br>事物功用的形式——价值,哲学价值就是形式价值,使用价值就是内容价值(美／面包）<br>事物功用的内容就是功能<br>事物利用的形式是技术<br>事物利用的内容是生产</p>
<p>事物的根本结构(形式)——层级结构<br>事物的根本内容——需要</p>
<p>事物的根本价值——好<br>事物的根本功能——满足主体需要<br>事物的根本技术——妙<br>事物的根本生产——满足客体需要<br>事物之间的根本作用是价值作用、利益作用,也就是对需要的作用——满足或者不满足对方需要的作用。<br>事物之间的根本关系是利益关系</p>
<ul>
<li><p>动态的存在</p>
</li>
<li><p>根本划分<br>静态的根本称为法则,动态的根本称为规律。<br>事物的根本就叫做根本。根本的来源叫做本原,事物的根本元素就是事物的本原<br>根本的实体称为本体,根本的属性称为本性。<br>根本的形式,称为本形;非根本的形式,称为末形;<br>根本的内容,称为本质;非根本的内容,称为末质。</p>
</li>
<li><p>认识的成果</p>
</li>
</ul>
<ul>
<li>概念是外界事物在人脑中的抽象反映</li>
<li>外延是反映在概念中的事物的现象</li>
<li>内涵是反映在概念中的事物的根本</li>
</ul>
<ul>
<li>认识的目的</li>
</ul>
<ul>
<li>真理是人脑对外界事物的正确反映。</li>
<li>谬误是人脑对外界存在的错误反映</li>
<li>根本性的真理就是真谛,</li>
<li>非根本性的真理就是俗谛</li>
</ul>
<h1 id="Gerneral_theroy_of_knowledge_—_Moritz_Schlik">Gerneral theroy of knowledge — Moritz Schlik</h1>
<h2 id="Common_concepts">Common concepts</h2>
<h3 id="认知是再认识or再发现">认知是再认识or再发现</h3>
<h3 id="知识就是把一种东西(现象)归结位另一种东西(原则)-">知识就是把一种东西(现象)归结位另一种东西(原则).</h3>
<ul>
<li>给狗一个名字, 那不是知识是见识!</li>
</ul>
<ul>
<li>有同一个原则解释的现象越多, 用来解释整个现象的所需的原则数目越少.</li>
<li>知识的水平用解释性原则的数目多少来衡量.</li>
<li>认知的最终任务就是使这个最低限度的数目尽可能的小.why?</li>
</ul>
<h3 id="科学知识的两个条件">科学知识的两个条件</h3>
<ul>
<li>完全规定个体(in/extension)</li>
<li>通过归结为最一般的东西来实现这种规定</li>
</ul>
<h3 id="知识的拥有与增长-">知识的拥有与增长.</h3>
<ul>
<li>任何学科,开始工作之前, 必须对研究主题形成确定概念(in/extension).在探究之前界定研究的领域.研究什么?希望的回答是什么?</li>
<li>主题的定义会随着展开关系, 变得明确, 但必须有最初的定义, 如光的定义.</li>
</ul>
<h3 id="Type_fo_问题">Type fo 问题</h3>
<ul>
<li><p>把所要知道的东西归结为什么样的因素(法则)?<br>一个学科的发展, 如物理学不断发展到现在的量子力学和相对论<br>计算机unix linux google 移动互联网 物联网</p>
</li>
<li><p>采取什么样的途径来实现这种归结?<br>天体运动归结为universal gravitation(因素/法则)<br>气象-&gt;热力学(因素/法则)</p>
</li>
</ul>
<ul>
<li>诚然, 对于求助于哪些因素作为解释性原则, 我们常常犯错, 因而被容易被某些捉摸不定的东西引向迷途.</li>
</ul>
<h2 id="知识的性质">知识的性质</h2>
<h3 id="认识论的意义">认识论的意义</h3>
<ul>
<li>清谬<br>运动本身不需要了解, 生理学知识, 也行.但病变的肢体就需要这些知识恢复.<br>同样, 悖谬时, 认识论澄清不合理.</li>
<li>深刻认知<br>另外, 科学的训练需要生理学知识, 高效的学习也同样学习epistemmology.<br>个门学科的展开不需要认识论的基础, 但除非经过认识论, 我们绝不会深刻的理解这些学科.<br>Helmholtz, every thing lead us to philosophy.</li>
</ul>
<h3 id="日常生活中的认知">日常生活中的认知</h3>
<ul>
<li>对知识做出圆满的定义在研究的后期甚至终结时才可靠, 如果我们接收这个观点, 领域的界限和进入点都会模糊不清.</li>
<li>狗, 知觉和心里意像相同</li>
</ul>
<h3 id="科学中的认知">科学中的认知</h3>
<ul>
<li>光, 两种法则相同</li>
<li>亚里士多德和手稿, 知识的核心都是再发现, </li>
</ul>
<h3 id="通过意象的认知">通过意象的认知</h3>
<ul>
<li>记忆意象是一种极为模糊, 变动不居, 容易像云雾那样消散的结构.<br>这就是我之前的学习状态, 所有东西都停留在意象层次, 根本不是细节的问题.</li>
</ul>
<h3 id="通过概念的认知">通过概念的认知</h3>
<p>属性称为概念的特性or特征<br>逻辑学, 概念的特征的总合叫概念的内涵/内容.概念所指的对象集合叫做概念的外延.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/firo/">firo</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/12/28/cogito/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/28/net/tunnel/" title="tunnel" itemprop="url">tunnel</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/116338260303228780000?rel=author" title="Firo Yang" target="_blank" itemprop="author">Firo Yang</a>
		
  <p class="article-time">
    <time datetime="2014-12-27T16:00:00.000Z" itemprop="datePublished"> Published Dec 28 2014</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="class">class</h1>
<p>network layer over network layer: gre<br>link layer over network layer: l2tp, pptp</p>
<h1 id="Proxy">Proxy</h1>
<p><a href="http://www.coder4.com/archives/4434" target="_blank" rel="external">透明代理、匿名代理、混淆代理、高匿代理有什么区别？</a></p>
<h2 id="正向代理forward_proxy">正向代理forward proxy</h2>
<p>shadowsocks goagent</p>
<h2 id="Reverse_proxy">Reverse proxy</h2>
<p>负载均衡的服务器, 缓存的静态内容的server</p>
<h2 id="透明代理">透明代理</h2>
<p>hiwifi router kproxy nginx, kproxy 是更细粒度的iptables.<br>所谓透明代理就是正向代理且client零配置.</p>
<h2 id="DMZ">DMZ</h2>
<p>Demilitarized zone, 解除军事武装区 or 非军事区!<br>这个跨领域的名字听上去, 好叼叼的, 现实中南极洲和三八线都是非军事区.<br>为什么叫这个名字, 暗指firewall没有设置太多限制规则的一部分网络地址空间.<br>内网和外网是争端的主角, 而DMZ是个缓冲区.</p>
<h3 id="simplest_sample">simplest sample</h3>
<p>iptables -A INPUT -p tcp -d 10.42.0.52 —dport 53 -j ACCEPT<br>iptables -A FORWARD -p tcp -d 192.168.1.2 —dport 53 -j ACCEPT<br>iptabltes -t nat -A PREOUTTING -p -tcp 10.42.0.52 —dport 53 -j DNAT —to 192.168.1.2:53<br>我们就知道了dmz有整体有两部分构成ACCEPT and DNAT<br>同时涉及到一个dmz地址空间{dmzwan10.42.0.52:53, dmzlan:192.168.1.2:53}</p>
<h1 id="Basic_concepts">Basic concepts</h1>
<ul>
<li>VPN is created by establishing a virtual point-to-point connection through the use of</li>
</ul>
<ol>
<li>dedicated connections(permanent)</li>
<li>virtual tunneling protocols<br>traffic encryptions and authentication</li>
</ol>
<ul>
<li>connection(tunnel) + secure</li>
</ul>
<h1 id="Tunnel_proctocol">Tunnel proctocol</h1>
<ul>
<li>pptp<br>data-link header | PPP | IP …<br>data-link header | IP | GRE | PPP | IP…<br>rfc2637<br><a href="http://pptpclient.sourceforge.net/diagrams.phtml" target="_blank" rel="external">http://pptpclient.sourceforge.net/diagrams.phtml</a> </li>
<li><p>pppd -&gt; /dev/ppp<br>/dev/ppp (see ppp_init) 下发密码, 加密之类的.<br>ppp_netdev_ops (see ppp_create_interface)<br>ppp_wirte-&gt;ppp_xmit_process-&gt;ppp_send_frame-&gt;ppp_push-&gt;|pch-&gt;chan-&gt;ops-&gt;start_xmit()=pppoe_xmit-&gt;__pppoe_xmit</p>
</li>
<li><p>init<br>pptp -&gt; pptp server -&gt; generate PPP connection and PPP0(interface)</p>
</li>
<li>input<br>eth -&gt; ppptp(remove gre header)-&gt;PPP header-&gt; pty(device) -&gt; PPP0(interface) -&gt; </li>
<li>output<br>-&gt; PPP0(interface) -&gt; PPP header -&gt; pty -&gt; PPPT(add gre header) -&gt; raw socket -&gt; eth</li>
</ul>
<ul>
<li>shadowsocks<br>user -&gt; iptables -&gt; shadowsocks(redir.c (struct server)-&gt;(struct remote)) -&gt; server</li>
</ul>
<p>ssh redsocks<br>user -&gt; iptables -&gt; redsocks -&gt; ssh -&gt; server</p>
<ul>
<li>pppoe<br>pppoe 的sk-&gt;sk_backlog_rcv是在pppoe_create中确定的, 这点却别与tcp socket<br>pppoe_rcv_core -&gt;　netif_rx<br>从sk_receive_skb来看pppoe 和tcp都对应一个session or sock!<br>对比inet_create 和 pppoe_create, 而pppoe很屌是在链路层的sock厉害!<br>pppoe报文会经过两次sk_filter()<br><a href="http://blog.csdn.net/osnetdev/article/details/8958058" target="_blank" rel="external">http://blog.csdn.net/osnetdev/article/details/8958058</a><br>&amp;pppoe_chan_ops;</li>
</ul>
<p>+ppp header<br>is added in ppp_start_xmit to ppp_send_frame NO ppp_hdr struct!<br>ppp-wan-&gt;ndo_start_xmit()=ppp_start_xmit()-&gt;ppp_xmit_process()-&gt;ppp_send_frame()<br>-&gt;<br>{<br>    __skb_push(skb, sizeof(*ph));<br>    skb_reset_network_header(skb);<br>    //add pppoe_hdr no header???<br>    dev_queue_xmit(skb);<br>}</p>
<h1 id="PPP">PPP</h1>
<p><a href="http://www.cnitblog.com/liaoqingshan/archive/2013/06/13/52906.html" target="_blank" rel="external">http://www.cnitblog.com/liaoqingshan/archive/2013/06/13/52906.html</a></p>
<h1 id="GRE">GRE</h1>
<p>include/net/gre.h</p>
<h1 id="L2tp">L2tp</h1>
<p>IP -&gt; UDP -&gt; L2TP -&gt; PPP</p>
<ul>
<li>source files<br>net/l2tp/<br>├── Kconfig<br>├── l2tp_core.c<br>├── l2tp_core.h<br>├── l2tp_debugfs.c<br>├── l2tp_eth.c<br>├── l2tp_ip.c<br>├── l2tp_netlink.c<br>├── l2tp_ppp.c<br>└── Makefile</li>
</ul>
<p>include/uapi/linux/ppp_defs.h</p>
<ul>
<li>Functions<br>l2tp_recv_common …recv_skb=pppol2tp_recv()<br>l2tp_xmit_core</li>
</ul>
<h1 id="PPTP">PPTP</h1>
<h2 id="Route_ip-list_to_pptp-vpn">Route ip-list to pptp-vpn</h2>
<p>11: pptp-vpn: <pointopoint,multicast,noarp,up,lower_up> mtu 1482 qdisc pfifo_fast state UNKNOWN qlen 3<br>    link/ppp<br>    inet 192.168.1.60 peer 192.168.1.1/32 scope global pptp-vpn<br>root@Hiwifi:~# route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>0.0.0.0         192.168.1.1     0.0.0.0         UG    0      0        0 pptp-vpn<br>123.121.94.19   192.168.10.254  255.255.255.255 UGH   0      0        0 eth2.2<br>192.168.1.1     0.0.0.0         255.255.255.255 UH    0      0        0 pptp-vpn<br>192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 eth2.2<br>192.168.199.0   0.0.0.0         255.255.255.0   U     0      0        0 br-lan</pointopoint,multicast,noarp,up,lower_up></p>
<h2 id="pptp_header">pptp header</h2>
<p>IP | GRE | pptp_gre_header | PPP | IP</p>
<h2 id="input">input</h2>
<p>ip -&gt; gre -&gt; ppp -&gt; ip<br>ip_local_deliver_finish()(netfilter NF LOCAL IN smartqos local in) -&gt;inet_protos.gre_rcv -&gt; gre_proto[GREPROTO_PPTP]=pptp_rcv{pptp_gre_header} -&gt; sk_receive_skb -&gt;sk_backlog_rcv -&gt; pptp_rcv_core -&gt; ppp_input -&gt; ppp_do_recv<br>-&gt; ppp_receive_frame -&gt; ppp_receive_nonmp_frame -&gt; netif_rx -&gt; netif_rx_internal -&gt; enqueue_to_backlog -&gt; ____napi_schedule(sd, &amp;sd-&gt;backlog);<br>-&gt; netif_receive_skb…</p>
<h2 id="output">output</h2>
<p>ip_output …-&gt; ppp_start_xmit -&gt; ppp_xmit_process -&gt; ppp_send_frame -&gt; add ppp header -&gt; ppp_push<br>-&gt;pch-&gt;chan-&gt;ops-&gt;start_xmit=pptp_xmit -&gt; add gre and ip header. -&gt; ip_local_out -&gt;<br>+another send skb functions is ip_build_and_send_pkt()<br>{ this functions hook is init in pptp_connect() -&gt; ppp_register_channel(&amp;po-&gt;chan) }<br>{ppp_connect()’s init functions is pptp_create, see pptp_init_module -&gt;<br>register_pppox_proto(PX_PROTO_PPTP, &amp;pppox_pptp_proto) pptp_create.}<br>when invoke pptp_create? socket()!</p>
<p>if layer 4 protocol is gre then pass.</p>
<h2 id="PPTP_&amp;_NAT">PPTP &amp; NAT</h2>
<ul>
<li>Forward package<br>br-lan(PREROUTING orginal packet NAT old)<br>(route -&gt; pptp-vpn) = ip_forward()-&gt;NF_INET_FORWARD-&gt;ip_forward_finish()-&gt;dst_output()<br>pptp-vpn -&gt; ndo_start_xmit -&gt; add some headers -&gt; local_out NAT new -&gt; tc dequeue_qdisc(this is maybe eth2.2’s routing result! see top)<br>so we need to do is just find original skb in PPTP packet header!</li>
</ul>
<h2 id="PPTP_&amp;_GRE_&amp;_Conntrack">PPTP &amp; GRE &amp; Conntrack</h2>
<p>As a pure IP protocol GRE uses only IP addresses but no port numbers giving the router’s NAT a tough time to track such a connection. In its base configuration OpenWrt Backfire is able to NAT a single PPTP connections but not multiple such connections concurrently. It is also unreliable when trying to establish consecutive single PPTP connections from different LAN clients in rapid succession.<br>=<br>kernel vpn just one session.</p>
<h2 id="ppp-&gt;_pptp_code-">ppp-&gt; pptp code.</h2>
<p>ppp_send_frame()<br>{</p>
<pre><code><span class="comment">//below is ok 132 is output!</span>
printk(<span class="string">"ct %d, %d, %d, %d\n"</span>, HWF_CT_EXT(ct)<span class="variable">-&gt;user_id</span>, user_id, HWF_CT_EXT(ct)<span class="variable">-&gt;is_marked</span>, proto);
<span class="keyword">switch</span>(proto) <span class="comment">//0x21, 33</span>
{

    <span class="comment">//Below two print is not show, so we did pass through these codes.</span>
    <span class="keyword">if</span> (cp == skb<span class="variable">-&gt;data</span> + <span class="number">2</span>) {
        <span class="comment">/* didn't compress */</span>
        printk(<span class="string">"NO compreess %x\n"</span>, ppp<span class="variable">-&gt;flags</span>);
        kfree_skb(new_skb);
    } <span class="keyword">else</span> {
        <span class="keyword">if</span> (cp[<span class="number">0</span>] &amp; SL_TYPE_COMPRESSED_TCP) {
            proto = PPP_VJC_COMP;
            cp[<span class="number">0</span>] &amp;= ~SL_TYPE_COMPRESSED_TCP;
        } <span class="keyword">else</span> {
            proto = PPP_VJC_UNCOMP;
            cp[<span class="number">0</span>] = skb<span class="variable">-&gt;data</span>[<span class="number">2</span>];
        }
        kfree_skb(skb);
        skb = new_skb;
        printk(<span class="string">"I am here %d ,%d, %x\n"</span>, cp[<span class="number">0</span>], proto, ppp<span class="variable">-&gt;flags</span>);


}
printk(<span class="string">"hit b %d\n"</span>, skb<span class="variable">-&gt;qosmark</span>);
skb = pad_compress_skb(ppp, skb);<span class="comment">//this functions skb will be replaced with a new_skab by alloc_skb();</span>
printk(<span class="string">"hit a %d\n"</span>, skb<span class="variable">-&gt;qosmark</span>);
<span class="comment">//...</span>
printk(<span class="string">"befor push %d %d\n"</span>, skb<span class="variable">-&gt;qosmark</span>, user_id);
skb<span class="variable">-&gt;qosmark</span> = user_id;

ppp<span class="variable">-&gt;xmit_pending</span> = skb;
ppp_push(ppp);
</code></pre><p>//dmesg<br>[  304.600000] ct 132, 132, 0, 33<br>[  304.610000] hit b 132<br>[  304.610000] hit a 0<br>[  304.610000] befor push 0 132<br>[  304.610000] out chan 132<br>[  304.620000] chan ok132<br>[  304.620000] qosmark132 132</p>
<pre><code>so we need <span class="operator"><span class="keyword">backup</span> qosmark be <span class="keyword">for</span> invoking this <span class="keyword">function</span> <span class="keyword">then</span> <span class="keyword">restore</span> it.</span>
</code></pre><p>}</p>
<p>ppp_push(struct ppp <em>ppp)<br>{<br>    struct list_head </em>list;<br>    struct channel <em>pch;<br>    struct sk_buff </em>skb = ppp-&gt;xmit_pending;</p>
<pre><code><span class="keyword">if</span> (<span class="subst">!</span>skb)
    <span class="keyword">return</span>;

<span class="built_in">list</span> <span class="subst">=</span> <span class="subst">&amp;</span>ppp<span class="subst">-&gt;</span>channels;
<span class="keyword">if</span> (list_empty(<span class="built_in">list</span>)) {
    <span class="comment">/* nowhere to send the packet, just drop it */</span>
    ppp<span class="subst">-&gt;</span>xmit_pending <span class="subst">=</span> <span class="built_in">NULL</span>;
    kfree_skb(skb);
    <span class="keyword">return</span>;
}

<span class="keyword">if</span> ((ppp<span class="subst">-&gt;</span>flags <span class="subst">&amp;</span> SC_MULTILINK) <span class="subst">==</span> <span class="number">0</span>) {
    <span class="comment">/* not doing multilink: send it down the first channel */</span>
    <span class="built_in">list</span> <span class="subst">=</span> <span class="built_in">list</span><span class="subst">-&gt;</span>next;
    pch <span class="subst">=</span> list_entry(<span class="built_in">list</span>, struct channel, clist);

    printk(<span class="string">"out chan %d\n"</span>, skb<span class="subst">-&gt;</span>qosmark);
    spin_lock_bh(<span class="subst">&amp;</span>pch<span class="subst">-&gt;</span>downl);
    <span class="keyword">if</span> (pch<span class="subst">-&gt;</span>chan) {
        printk(<span class="string">"chan ok%d\n"</span>, skb<span class="subst">-&gt;</span>qosmark);
        <span class="keyword">if</span> (pch<span class="subst">-&gt;</span>chan<span class="subst">-&gt;</span>ops<span class="subst">-&gt;</span>start_xmit(pch<span class="subst">-&gt;</span>chan, skb))
            ppp<span class="subst">-&gt;</span>xmit_pending <span class="subst">=</span> <span class="built_in">NULL</span>;
    } <span class="keyword">else</span> {
        <span class="comment">/* channel got unregistered */</span>
        printk(<span class="string">"no chan\n"</span>, skb<span class="subst">-&gt;</span>qosmark);
        kfree_skb(skb);
        ppp<span class="subst">-&gt;</span>xmit_pending <span class="subst">=</span> <span class="built_in">NULL</span>;
</code></pre>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/net/">net</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/12/28/net/tunnel/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/3/"><span></span>Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/cs/" title="cs">cs<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/firo/" title="firo">firo<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/howto/" title="howto">howto<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/kernel/" title="kernel">kernel<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/list/" title="list">list<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/net/" title="net">net<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/philosophy/" title="philosophy">philosophy<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/kernel/" title="kernel">kernel<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/net/" title="net">net<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/cs/" title="cs">cs<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/comic/" title="comic">comic<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/animation/" title="animation">animation<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/howto/" title="howto">howto<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/firo/" title="firo">firo<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.snooda.com" target="_blank" title="Snooda">Snooda</a>
            
          </li>
        
          <li>
            
            	<a href="http://ifind.cc" target="_blank" title="江长顺">江长顺</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/firodb/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/firogh" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/1025001" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/firoter" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		<a href="https://www.linkedin.com/in/firoli" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/firodb" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		
		<a href="https://plus.google.com/116338260303228780000?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:firogm@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="Firo Yang">Firo Yang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'firoyang';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-63396532-1', 'firoyang.org');  
ga('send', 'pageview');
</script>



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F170c29f9e12f3a9c2477a313ab84017e' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
