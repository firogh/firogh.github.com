setup_per_cpu_areas

[Per-CPU variables at umd.edu ](https://www.cs.umd.edu/class/fall2015/cmsc412/percpu.pdf)

load_percpu_segment
For x86 64, use gx the segment selector
# x86_64: kernel cpu
arch_raw_cpu_ptr

# per cpu gdt page
a939098afcfa5f81d3474782ec15c6d114e57763
x86: move x86_64 gdt closer to i386
kernel_init->smp_init->cpu_up->native_cpu_up->do_boot_cpu

# x86_64: per-cpu memory for user-space
https://lwn.net/Articles/611946/

# sp0
struct task_struct *, current_task
818 #define INIT_THREAD  {                                                    \
819         .sp0                    = TOP_OF_INIT_STACK,                      \

