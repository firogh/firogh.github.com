<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">

<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="description" content="">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="keywords" content="cs, ">

 
<meta property="og:type" content="article"/>
<meta property="og:description" content=""/>
<meta property="og:title" content="Memory consistency model : firoyang.org"/>
<meta property="og:site_name" content="Firo Website"/>
<meta property="og:image" content="" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:image:width" content="" />
<meta property="og:image:height" content="" />
<meta property="og:url" content="http://firoyang.org/cs/consistency_model/">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2017-12-16"/>
<meta property="article:modified_time" content="2017-12-16"/>


<meta property="article:tag" content="cs">





    <base href="http://firoyang.org/">
    <title> Memory consistency model</title>
    <link rel="canonical" href="http://firoyang.org/cs/consistency_model/">

    
<link rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/static/css/style.css">


    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
     
</head>

<body style="background-color:#FFFFF0;" lang="en" itemscope itemtype="http://schema.org/Article">
<body lang="en" itemscope itemtype="http://schema.org/Article">
<header id="header">
	<link rel="stylesheet" href="static/css/font-awesome.min.css">
	<nav id="nav">
	<div id="title"><a href="/" style="color:#B22222;">ƒ(x)</a></div>


	
	</nav>
	<nav id="nav">
    	        <ul id="mainnav">
            <li>
            <a href="/review/" >
                <span class="icon"> <i aria-hidden="false" style="background-color:#FFFFF0" class="fa fa-thumbs-o-up"></i></span>
                <span> review</span>
            </a>
            </li>
            <li>
            <a href="/life/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-male"></i></span>
                <span> life </span>
            </a>
            </li>
            <li>
            <a href="/history/" >
                <span class="icon"> <i aria-hidden="false" style="background-color:#FFFFF0" class="fa fa-institution"></i></span>
                <span> history </span>
            </a>
	    <li>
                <a href="/language/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-language"></i></span>
                <span> linguistics </span>
            </a>
            </li>
            </li>
            <li>
                <a href="/howto/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-gamepad"></i></span>
                <span> howto </span>
            </a>
            </li>
            <li>
            <a href="/cs/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-linux"></i></span>
                <span> cs </span>
            </a>
            </li>
            <li>
            <a href="/net/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-globe"></i></span>
                <span> net </span>
            </a>
            </li>
            <li>
            <a href="/philosophy/" >
                <span class="icon"> <i aria-hidden="true" style="background-color:#FFFFF0" class="icon-leaf"></i></span>
                <span> philosophy </span>
            </a>
            </li>

            
            

            <li>
            <a href="/" style="color:#B22222" >
                <span class="icon" > <i aria-hidden="true" style="background-color:#FFFFF0" class="fa fa-rocket"></i></span>
                
            </a>
            </li>

        </ul>

	</nav>
	<nav id="nav">
               <ul id="social">

            <li id="follow">
                
                
                <div class="dropdown follow">
                    <ul class="social">
                        <li> <a href="http://www.twitter.com/firoyang" target="_blank" class="twitter"><span class="icon icon-twitter"></span>Twitter</a> </li>
                        <li> <a href="mailto:firogm@gmail.com" style="color:#B22222;"  class="gmail"><span style="color:#B22222;" class="icon icon-mail"></span>Gmail</a> </li-->
                        
                        
                        
                        
                        
                        
                        
                    </ul>
                    
                </div>
            </li>
            

        </ul>

	</nav>
</header>



 <link rel="stylesheet" href="highlight.js/styles/monokai-sublime.css">
    <script src="highlight.js/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
	<section id="main">

	  <h1 itemprop="name" id="title" style="color:#B22222;" >Memory consistency model</h1>
	  

<aside id="meta">

    <div>
        <section id="datecount">
          <h4 id="date"> Sat Dec 16, 2017 </h4>
          
        </section>
        
        <ul id="tags">
          
            <li> <a href="http://firoyang.org//tags/cs">cs</a> </li>
          
        </ul>

    </div>


</aside>

<meta itemprop="wordCount" content="511">
<meta itemprop="datePublished" content="2017-12-16">
<meta itemprop="url" content="http://firoyang.org/cs/consistency_model/">


	  <div>
		<article itemprop="articleBody" id="content">
		   

<p>When we are talking on memory model, we are refering memory consistency model or memory ordering model.</p>

<h1 id="hisotry">Hisotry</h1>

<p>1979<br />
<a href="https://www.microsoft.com/en-us/research/uploads/prod/2016/12/How-to-Make-a-Multiprocessor-Computer-That-Correctly-Executes-Multiprocess-Programs.pdf">How to Make a Multiprocessor Computer That Correctly Executes Multiprocess Progranm</a><br />
1987 ~ 1990<br />
<a href="https://cs.brown.edu/~mph/HerlihyW90/p463-herlihy.pdf">Linearizability: A Correctness Condition for Concurrent Objects</a><br />
1989<br />
<a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.8.3766&amp;rep=rep1&amp;type=pdf">processor consistency: CACHE CONSISTENCY AND SEQUENTIAL CONSISTENCY</a><br />
1990<br />
<a href="https://dl.acm.org/citation.cfm?id=325102">Release consistency: Memory consistency and event ordering in scalable shared-memory multiprocessors</a><br />
1991<br />
<a href="https://dl.acm.org/citation.cfm?id=113406">Proving sequential consistency of high-performance shared memories</a><br />
1992<br />
<a href="https://www.gaisler.com/doc/sparcv8.pdf">TSO Sparc v8: A standard memory model called Total Store Ordering (TSO) is defined for SPARC</a><br />
<a href="https://link.springer.com/chapter/10.1007/978-1-4615-3604-8_2">Formal Specification of Memory Models: and two store ordered models TSO and PSO defined by the Sun Microsystem&rsquo;s SPARC architecture.</a></p>

<p>2001 ~ Present<br />
<a href="https://www.youtube.com/watch?v=WUfvvFD5tAA">IA64 memory ordering</a></p>

<h1 id="purposes">Purposes</h1>

<p><a href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s12/www/lectures/14_relaxedReview.pdf">Motivation: hiding latency</a><br />
▪ Why are we interested in relaxing ordering requirements?<br />
- Performance<br />
- Speci!cally, hiding memory latency: overlap memory accesses with other operations<br />
- Remember, memory access in a cache coherent system may entail much more then<br />
simply reading bits from memory (!nding data, sending invalidations, etc.)</p>

<h2 id="why-tso-it-s-because-that-write-buffer-or-store-buffer-is-not-invisible-any-more-for-multiprocessor-https-www-cis-upenn-edu-devietti-classes-cis601-spring2016-sc-tso-pdf">Why TSO? <a href="https://www.cis.upenn.edu/~devietti/classes/cis601-spring2016/sc_tso.pdf">It&rsquo;s because that write buffer or Store buffer is not invisible any more for multiprocessor</a></h2>

<p>To abandon SC; to Allow use of a FIFO write buffer.<br />
<a href="https://www.cs.utexas.edu/~bornholt/post/memory-models.html">An example: There’s no reason why performing event (2) (a read from B) needs to wait until event (1) (a write to A) completes. They don’t interfere with each other at all, and so should be allowed to run in parallel. See Memory Consistency Models: A Primer</a><br />
Hide the write latency by putting the data in the store buffer.</p>

<h3 id="why-not-read-write-reordering">Why not read-write reordering?</h3>

<p>reordering read-write is non-sense.</p>

<h1 id="formal-cause">Formal cause</h1>

<p>Shared memory<br />
Multiprocessor<br />
Memory access<br />
program order<br />
<a href="https://www.hpl.hp.com/techreports/Compaq-DEC/WRL-95-7.pdf">Recommened by CAAQA: Observity in SC, TSO, PC: Paragraph Relaxing the Write to Read Program Order in Shared Memory Consistency Models: A Tutorial</a><br />
<a href="http://www.rdrop.com/users/paulmck/scalability/paper/whymb.2010.06.07c.pdf">Memory Barriers: a Hardware View for Software Hackers - must read</a><br />
<a href="http://15418.courses.cs.cmu.edu/spring2013/article/41">&lsquo;A Summary of Relaxed Consistency&rsquo; CMU</a><a href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s12/www/lectures/14_relaxedReview.pdf">Slides</a></p>

<h2 id="sc">SC</h2>

<p><a href="https://www.microsoft.com/en-us/research/uploads/prod/2016/12/How-to-Make-a-Multiprocessor-Computer-That-Correctly-Executes-Multiprocess-Programs.pdf">sequential consistency</a><br />
<a href="https://jepsen.io/consistency/models/sequential#formally">Formal of Sequential Consistency by Jepsen</a></p>

<h2 id="tso">TSO</h2>

<p>Total Store Ordering in Appendix k Sparc v8.</p>

<h3 id="tso-in-x86">TSO in x86</h3>

<p><a href="https://www.cl.cam.ac.uk/~pes20/weakmemory/x86tso-paper.tphols.pdf">A Better x86 Memory Model: x86-TSO</a><br />
<a href="https://stackoverflow.com/questions/27595595/when-are-x86-lfence-sfence-and-mfence-instructions-required">When are x86 LFENCE, SFENCE and MFENCE instructions required?</a></p>

<h3 id="tso-vs-pc">TSO vs PC:</h3>

<p><a href="http://15418.courses.cs.cmu.edu/spring2013/article/41">&lsquo;A Summary of Relaxed Consistency&rsquo; CMU</a><a href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s12/www/lectures/14_relaxedReview.pdf">Slides</a></p>

<h3 id="tso-and-peterson-s-algorithm">TSO and Peterson&rsquo;s algorithm</h3>

<p><a href="https://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/">Who ordered memory fences on an x86?</a><br />
<a href="https://www.cnblogs.com/caidi/p/6708789.html">共同进入与饥饿</a></p>

<h2 id="pc">PC</h2>

<p><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.8.3766&amp;rep=rep1&amp;type=pdf">processor consistency: CACHE CONSISTENCY AND SEQUENTIAL CONSISTENCY</a></p>

<h2 id="wc">WC</h2>

<p><a href="https://people.eecs.berkeley.edu/~kubitron/cs252/handouts/oldquiz/p434-dubois.pdf">weak consistency: Memory access buffering in multiprocessors</a><br />
They distinguish between ordinary shared accesses and synchronization accesses, where the latter are used to control concurrency<br />
between several processes and to maintain the integrity of ordinary shared data.</p>

<h2 id="rc">RC</h2>

<p><a href="https://dl.acm.org/citation.cfm?id=325102">Firo: a must-read: Release consistency: Memory consistency and event ordering in scalable shared-memory multiprocessors</a><br />
<a href="https://docs.microsoft.com/en-us/windows/win32/dxtecharts/lockless-programming?redirectedfrom=MSDN#read-acquire-and-write-release-barriers">Must-read: Lockless Programming Considerations for Xbox 360 and Microsoft Windows</a><br />
At right top of page 6<br />
Condition 3.1: Conditions for Release Consistency<br />
(A) before an ordinary load or store access is allowed to perform with respect to any other processor,<br />
all previous acquire accesses must be performed, and<br />
(B) before a release access is allowed to perform with<br />
respect to any other processor, all previous ordinary<br />
load and store accesses must be performed, and<br />
&copy; special accesses are processor consistent with respect to one another.<br />
<a href="https://preshing.com/20120913/acquire-and-release-semantics/">Acquire and Release Semantics</a></p>

		</article>
	  </div>
	</section>

<aside id=comments>
    <div><h2> Comments </h2></div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'firoyang';
    var disqus_identifier = 'http:\/\/firoyang.org\/cs\/consistency_model\/';
    var disqus_title = 'Memory consistency model';
    var disqus_url = 'http:\/\/firoyang.org\/cs\/consistency_model\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</aside>

<footer>
  <div>
    <p>
    &copy; 2014 ~ 2016 <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Firo Yang </span></span><a href="http://creativecommons.org/licenses/by/4.0/">Some rights reserved</a>. 
	Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://fortawesome.github.io/Font-Awesome/">Font Awesome</a>.
        Theme by <a href="http://spf13.com">Steve Francia <a href="http://firoyang.org">Firo Yang</a>.
    </p>
  </div>
</footer>
<script type="text/javascript">
(function(){var j=function(a,b){return window.getComputedStyle?getComputedStyle(a).getPropertyValue(b):a.currentStyle[b]};var k=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent('on'+b,c)};var l=function(a,b){for(key in b)if(b.hasOwnProperty(key))a[key]=b[key];return a};window.fitText=function(d,e,f){var g=l({'minFontSize':-1/0,'maxFontSize':1/0},f);var h=function(a){var b=e||1;var c=function(){a.style.fontSize=Math.max(Math.min(a.clientWidth/(b*10),parseFloat(g.maxFontSize)),parseFloat(g.minFontSize))+'px'};c();k(window,'resize',c)};if(d.length)for(var i=0;i<d.length;i++)h(d[i]);else h(d);return d}})();
fitText(document.getElementById('title'), 1)
</script>




</body>
</html>


<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

</body>
