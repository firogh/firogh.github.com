# References
[Evolution of the x86 context switch in Linux](https://www.maizure.org/projects/evolution_x86_context_switch_linux/index.html)

# Task switch
[Al Viro's new execve/kernel_thread design](https://lwn.net/Articles/520227/)
## call+jump+ret - 0100301bfdf56a2a370c7157b5ab0fbf9313e1cd
((last) = __switch_to_asm((prev), (next)));                             #=====> call
jmp     __switch_to                                                     #=====> jmp + ret

## Old version switch_to - push+jmp+ret
switch_to
-       asm volatile("pushl %%ebp\n\t"          /* save    EBP   */     \
-                    "movl %%esp,%[prev_sp]\n\t"        /* save    ESP   */ \   #=====>PREV: Save ESP into task struct thread.
-                    "movl %[next_sp],%%esp\n\t"        /* restore ESP   */ \   #=====>NEXT: Setup stack for linkage from task struct thread.
-                    "movl $1f,%[prev_ip]\n\t"  /* save    EIP   */     \       #=====>PREV: Save PC into task sturct thread.
-                    "pushl %[next_ip]\n\t"     /* restore EIP   */     \       #=====>NEXT: push - Store PC on stack from task struct thread;
-                    "jmp __switch_to\n"        /* regparm call  */     \       #=====>NEXT: jmp + ret - Return and restore PC. 
-                    "1:\t"                                             \
-                    "popl %%ebp\n\t"           /* restore EBP   */     \
-                                                                       \
-                    /* output parameters */                            \
-                    : [prev_sp] "=m" (prev->thread.sp),                \
-                      [prev_ip] "=m" (prev->thread.ip),                \
-                      "=a" (last),                                     \
-                                                                       \
-                      /* clobbered output registers: */                \
-                      "=b" (ebx), "=c" (ecx), "=d" (edx),              \
-                      "=S" (esi), "=D" (edi)                           \
-                      /* input parameters: */                          \
-                    : [next_sp]  "m" (next->thread.sp),                \
-                      [next_ip]  "m" (next->thread.ip),                \
[Why does switch_to use push+jmp+ret to change EIP, instead of jmp directly?](https://stackoverflow.com/questions/15019986/why-does-switch-to-use-pushjmpret-to-change-eip-instead-of-jmp-directly/15024312)

